<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="color-scheme" content="dark"/>
<title>Leaderboard ‚Äî Referral Race</title>

<style>
  :root{
    --bg0:#0a0c16; --bg1:#0f1026; --edge:#ffffff18;
    --ink:#eaf2ff; --dim:#b8c6ff;
    --teal:#37e0d7; --vio:#a975ff; --vio2:#7a5cff; --acc:#ffd86a;
    --card1:#121433; --card2:#0d0f2a;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;height:100%;overflow-x:hidden;color:var(--ink);
    font:15px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at 50% -10%, #2b1f55 0%, transparent 60%),
      linear-gradient(180deg,#0b0c1a,#070813);
  }
  .app{max-width:520px;margin:0 auto;min-height:100dvh;display:grid;grid-template-rows:auto 1fr}

  /* Header */
  header{position:sticky;top:0;z-index:20;padding:12px 16px;
    background:linear-gradient(180deg,#10112a,#0d0e23);border-bottom:1px solid var(--edge)}
  .hrow{display:flex;align-items:center;justify-content:space-between}
  .title{font-weight:1000;letter-spacing:.2px;font-size:22px}

  main{padding:14px 14px 116px}
  .card{
    background:
      radial-gradient(600px 140px at 10% -30%, rgba(55,224,215,.18), transparent 60%),
      radial-gradient(600px 140px at 90% -30%, rgba(169,117,255,.18), transparent 60%),
      linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.00)),
      linear-gradient(180deg,var(--card1),var(--card2));
    border:1px solid var(--edge);border-radius:18px;padding:14px;margin-bottom:12px;
    box-shadow:0 18px 50px #00000050, inset 0 0 0 1px #ffffff05
  }
  h2,h3{margin:0 0 8px}
  p{margin:0 0 8px;color:#dfe5ff}

  /* Segmented control */
  .lbHead{display:flex;align-items:center;justify-content:space-between}
  .seg{display:flex;gap:8px;background:#0f1030;border:1px solid var(--edge);padding:6px;border-radius:14px}
  .seg button{appearance:none;border:0;background:transparent;color:#cfd4ff;font-weight:900;padding:9px 14px;border-radius:10px;cursor:pointer}
  .seg button.active{color:#fff;background:linear-gradient(180deg,var(--vio),var(--vio2));box-shadow:0 10px 26px rgba(153,120,255,.45), inset 0 -2px 10px rgba(0,0,0,.25)}
  .filters{display:flex;gap:8px;margin-top:10px}
  .pick{appearance:none;background:#0f1030;color:#eaf0ff;border:1px solid var(--edge);
    border-radius:12px;padding:10px 12px;font-weight:800}
  .scope{font-size:12px;color:var(--dim);margin-top:6px}

  /* Podium */
  .podiumWrap{
    margin-top:14px;border-radius:24px;padding:18px 10px 12px;
    background:
      radial-gradient(240px 80px at 50% 0%, rgba(55,224,215,.25), transparent 70%),
      linear-gradient(180deg,#171442,#121238);
    border:1px solid #ffffff22; box-shadow:
      0 20px 60px rgba(36,18,66,.55),
      inset 0 10px 30px rgba(255,255,255,.05),
      inset 0 -20px 30px rgba(0,0,0,.25)
  }
  .podium{display:grid;grid-template-columns:1fr 1.2fr 1fr;gap:10px;align-items:end}
  .step{
    position:relative;border-radius:18px 18px 12px 12px;
    background:linear-gradient(180deg,#221a54,#16113b);
    padding:12px 8px 16px;border:1px solid #ffffff1c;
    box-shadow:inset 0 -14px 22px rgba(120,90,210,.25), 0 10px 24px rgba(0,0,0,.35);
    display:grid;place-items:center;min-height:100px
  }
  .s1{min-height:140px}.s2{min-height:116px}.s3{min-height:110px}
  .av{
    position:absolute;top:-66px;left:50%;transform:translateX(-50%);
    width:78px;height:78px;border-radius:50%;border:5px solid #fff;
    box-shadow:0 12px 26px rgba(0,0,0,.35), 0 0 0 8px rgba(122,92,255,.15);
    background:#fff center/cover no-repeat;z-index:2
  }
  .crown{position:absolute;top:-96px;left:50%;transform:translateX(-50%);z-index:4;font-size:40px;line-height:1}
  .badge{
    position:absolute;bottom:8px;left:50%;transform:translateX(-50%);z-index:5;
    background:linear-gradient(180deg,#6f4bff,#9f7bff);color:#fff;border-radius:999px;font-weight:1000;
    border:2px solid #ffffff;box-shadow:0 6px 16px rgba(0,0,0,.35);padding:2px 8px;font-size:12px
  }
  .name{margin-top:18px;font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .mini{color:#e8deff;font-size:12px;margin-top:4px;display:flex;align-items:center;gap:6px} /* small gap BELOW username */
  .mini .pt{font-weight:900}

  /* Header row ‚Äî wider spacing (Rank | Player | Points) */
  .hdrRow{
    display:grid;grid-template-columns:60px 1fr 110px;gap:10px;align-items:center;
    margin-top:14px;background:linear-gradient(180deg,#2f325f,#26294e);color:#e9ecff;
    border:1px solid #ffffff22;border-radius:16px;padding:10px 12px;font-weight:900
  }
  .hdrRow div:last-child{text-align:right}

  /* Flat list rows with subtle shadow */
  .list{margin-top:10px;display:grid;gap:10px}
  .row{
    display:grid;grid-template-columns:60px 1fr 110px;gap:10px;align-items:center;
    background:linear-gradient(180deg,rgba(25,26,55,.9),rgba(22,21,42,.9));
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;padding:10px 12px;
    box-shadow:0 8px 18px rgba(0,0,0,.35)
  }
  .rk{
    display:grid;place-items:center;width:42px;height:42px;border-radius:12px;font-weight:1000;
    background:linear-gradient(180deg,rgba(255,255,255,.18),rgba(255,255,255,.06));border:1px solid rgba(255,255,255,.28)
  }
  .face{
    width:38px;height:38px;border-radius:50%;background:#eee center/cover no-repeat;border:2px solid #fff;margin-right:8px;
    box-shadow:0 6px 14px rgba(0,0,0,.25)
  }
  .left{display:flex;align-items:center;gap:10px}
  .uname{font-weight:1000}
  .val{font-weight:900;color:#fff;text-align:right}

  /* Search */
  .search{margin-top:12px;display:grid;grid-template-columns:1fr auto;gap:8px}
  .input{border-radius:12px;border:1px solid var(--edge);background:#0f1030;color:#eff3ff;padding:10px 12px}
  .go{appearance:none;border:0;border-radius:12px;padding:10px 12px;background:#ffd86a;color:#3a2400;font-weight:1000;cursor:pointer;box-shadow:0 4px 0 rgba(0,0,0,.12)}
  .go:active{transform:translateY(1px);box-shadow:0 2px 0 rgba(0,0,0,.12)}
  .result{margin-top:8px;background:rgba(255,255,255,.92);border:1px solid rgba(0,0,0,.08);color:#2b2350;border-radius:12px;padding:10px 12px;font-weight:800;display:none}

  /* Bottom nav (text highlight only) */
  .iconnav{position:fixed;left:50%;transform:translateX(-50%);bottom:max(8px,env(safe-area-inset-bottom,0));
    width:min(520px,100% - 12px);display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:10px 12px;
    background:rgba(16,17,42,.98);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);
    border-radius:16px;z-index:1000}
  .itab{appearance:none;border:0;background:transparent;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 6px;color:#cdd7ff;font-weight:800;border-radius:14px}
  .itab.active{color:#fff}
  .ico{width:26px;height:26px;fill:none;stroke:currentColor;stroke-width:1.8}

  /* Sound toggle */
  .soundBtn{position:fixed;right:12px;bottom:calc(72px + env(safe-area-inset-bottom,0));background:#fff;color:#111;border:1px solid rgba(0,0,0,.08);
    border-radius:14px;padding:10px 12px;display:none;gap:8px;align-items:center;font-weight:1000;z-index:1100;box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .soundBtn.show{display:inline-flex} .soundBtn.active{background:linear-gradient(90deg,#ffd86a,#ffc24d)}
  .soundBtn .ic{width:22px;height:22px;fill:none;stroke:currentColor;stroke-width:1.8}

  /* Community */
  .comm .sharebar{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .comm .sharebtn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;background:#ffd86a;color:#2a1a00;box-shadow:0 4px 0 rgba(0,0,0,.12)}
  .comm .list{display:grid;gap:14px;margin-top:12px}
  .comm .item{background:linear-gradient(180deg,#5a34dd,#4a2bc7);border:1px solid rgba(255,255,255,.12);border-radius:20px;padding:16px;color:#fff;display:flex;align-items:center;justify-content:space-between}
  .comm .bubble{width:44px;height:44px;border-radius:12px;background:#fff;display:grid;place-items:center}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="hrow"><div class="title">Leaderboard</div><div style="font-size:12px;color:#c8d0ff">v6</div></div>
    </header>
    <main id="view"></main>
  </div>

  <!-- Bottom Nav -->
  <nav class="iconnav" aria-label="Primary">
    <button class="itab active" data-tab="ranks" data-idx="0">
      <svg class="ico" viewBox="0 0 24 24"><path d="M7 22V11a2 2 0 0 1 2-2h6v13H7zM3 22v-7a2 2 0 0 1 2-2h1v9H3zM17 22V5a2 2 0 0 1 2-2h2v19h-4zM10 5l2-3 2 3"/></svg><span>Ranking</span>
    </button>
    <button class="itab" data-tab="home" data-idx="1">
      <!-- T&C icon -->
      <svg class="ico" viewBox="0 0 24 24"><path d="M7 3h7l4 4v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zM14 3v5h5"/></svg>
      <span>T&C</span>
    </button>
    <button class="itab" data-tab="community" data-idx="2">
      <svg class="ico" viewBox="0 0 24 24"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4 0-8 2-8 5v1h16v-1c0-3-4-5-8-5z"/></svg><span>Community</span>
    </button>
  </nav>

  <!-- Theme music -->
  <audio id="bgm" src="theme.mp3" preload="auto" loop playsinline></audio>
  <button id="soundBtn" class="soundBtn" aria-label="Toggle sound" title="Sound">
    <svg viewBox="0 0 24 24" class="ic"><path d="M4 10h4l5-4v12l-5-4H4zM17 8a5 5 0 010 8"/></svg><span>Sound</span>
  </button>

<script>
/* ===== CONFIG ===== */
const SHEET_ID   = "1rJg4RYn0AkvsqhVGk5CwhZrYNz0gFC6_7ZPiDXigU-o";
const GID_DAILY  = "1891032775";   // Daily tab gid
const GID_WEEKLY = "0";            // Weekly tab gid

/* helpers */
const $=(s,el)=> (el||document).querySelector(s);
const $all=(s,el)=> Array.from((el||document).querySelectorAll(s));
const unique=a=>Array.from(new Set(a));
const fmtFull=n=>Number(n||0).toLocaleString();
const faceBg=url=>`url("${url}")`;
const TROPHY="üèÜ";
function maskMiddle3(name){
  const s=String(name||''); if(s.length<3) return s.replace(/.(?=.)/g,'*');
  const mid=Math.floor(s.length/2); const start=Math.max(0,mid-1), end=Math.min(s.length,mid+2);
  return s.slice(0,start) + '***' + s.slice(end);
}

/* Avatars (DiceBear ‚Äì CC0). Replace with your own if needed */
const AVS=[
  "https://ricobr.ft-crm.com/media-api/serve/8f954107-4d24-4d5c-b2fe-934b14e56215_1010.png",
  "https://ricobr.ft-crm.com/media-api/serve/5368d6f5-3904-42d6-9ef9-314cd544ad95_11.png",
  "https://ricobr.ft-crm.com/media-api/serve/738cf89e-f4df-49e2-b359-fd5f9a7095a7_1111-1.png",
  "https://ricobr.ft-crm.com/media-api/serve/dad111b1-5443-4e26-97b4-b5bf84cb953e_1212.png",
  "https://ricobr.ft-crm.com/media-api/serve/5aa2965f-6173-4aa4-a2c8-fabd93415637_1313.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/50079348-7f59-4b35-b2db-0dd9d9cf71b2_1414.png",
  "https://ricobr.ft-crm.com/media-api/serve/48624ef5-7940-4cac-a364-92e6a3ded6cd_1515.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/23fe46f7-7713-42fb-b918-11d0173a8b2f_22.png",
  "https://ricobr.ft-crm.com/media-api/serve/454a5792-2006-449b-b5e4-d549df35cc5c_33.png",
  "https://ricobr.ft-crm.com/media-api/serve/91f4a46e-038c-45f6-8394-fe83d2e104ad_44.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/37f48336-28bb-467d-ad32-c352c72e317d_55.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/c97d00c2-6940-430f-812d-1a2b63337083_88.png",
  "https://ricobr.ft-crm.com/media-api/serve/044b1d20-a2bd-4743-b113-1b88673be3e6_77.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/e92e6bae-ece8-44e9-907e-6eda2f2e4267_66.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/d31d5f4d-d487-44c2-a8f6-441ac6a7539c_99.png",
  "https://ricobr.ft-crm.com/media-api/serve/5368d6f5-3904-42d6-9ef9-314cd544ad95_11.png",
  "https://ricobr.ft-crm.com/media-api/serve/738cf89e-f4df-49e2-b359-fd5f9a7095a7_1111-1.png",
  "https://ricobr.ft-crm.com/media-api/serve/dad111b1-5443-4e26-97b4-b5bf84cb953e_1212.png",
  "https://ricobr.ft-crm.com/media-api/serve/5aa2965f-6173-4aa4-a2c8-fabd93415637_1313.jpg",
  "https://ricobr.ft-crm.com/media-api/serve/50079348-7f59-4b35-b2db-0dd9d9cf71b2_1414.png",
];
const rankAvatar=r=>AVS[Math.min(Math.max(1,r),20)-1];

/* Bottom nav */
let TAB='ranks';
$all('.iconnav .itab').forEach(btn=>{
  btn.addEventListener('click',()=>{ TAB=btn.dataset.tab; $all('.itab').forEach(b=>b.classList.toggle('active',b===btn)); render();});
});

/* Music autoplay + fallback */
(function(){
  const audio=$('#bgm'), btn=$('#soundBtn'); if(!audio||!btn) return;
  const saved=localStorage.getItem('bgm_pref'); if(saved==='off'){audio.muted=true} if(saved==='on'){audio.muted=false}
  document.addEventListener('DOMContentLoaded',tryPlay,{once:true});
  async function tryPlay(){try{
    if(localStorage.getItem('bgm_pref')==='off'){btn.classList.add('show');return}
    audio.muted=false; await audio.play(); btn.classList.remove('show'); localStorage.setItem('bgm_pref','on')
  }catch{ btn.classList.add('show'); ['pointerdown','keydown','touchstart'].forEach(evt=>document.addEventListener(evt,unlock,{once:true}))}}
  async function unlock(){try{audio.muted=false;await audio.play();btn.classList.remove('show');btn.classList.add('active');localStorage.setItem('bgm_pref','on')}catch{}}
  btn.addEventListener('click',async()=>{try{
    if(audio.paused){audio.muted=false;await audio.play()} else {audio.muted=!audio.muted;if(audio.muted)await audio.pause();else await audio.play()}
    const on=!audio.paused && !audio.muted; btn.classList.toggle('active',on); if(on) btn.classList.remove('show'); localStorage.setItem('bgm_pref',on?'on':'off')
  }catch{}})
})();

/* GViz fetch + normalize */
async function gviz(gid){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${encodeURIComponent(gid)}`;
  const text=await fetch(url,{cache:"no-store"}).then(r=>r.text());
  const j=(text.match(/google\.visualization\.Query\.setResponse\((.*)\);?/s)||[])[1]; if(!j) throw new Error('parse');
  const data=JSON.parse(j);
  const headers=data.table.cols.map(c=>c.label||c.id||"");
  const rows=data.table.rows.filter(r=>r&&r.c).map(r=> r.c.map(c=> c?(c.f!=null?c.f:c.v):""));
  return {headers,rows};
}
const pickIndex=(headers,aliases)=>{const L=headers.map(h=>String(h||'').toLowerCase());for(const a of aliases){const j=L.findIndex(h=>h.includes(a));if(j>-1)return j}return -1};
function normalize({headers:h,rows}){
  const ri=pickIndex(h,["rank","posi√ß√£o","posicion"]);
  const ui=pickIndex(h,["username","user","player","name"]);
  const pi=pickIndex(h,["points","score","pontos"]);
  const wi=pickIndex(h,["week","semana"]);
  const di=pickIndex(h,["date","day","fecha"]);
  if(ri<0||ui<0||pi<0) throw new Error('Missing Rank/Username/Points columns');
  return rows.map(r=>({
    rank:Number(String(r[ri]).replace(/[^\d.\-]/g,''))||0,
    username:String(r[ui]||"").trim(),
    points:Number(String(r[pi]).replace(/[^\d.\-]/g,''))||0,
    week: wi>-1 ? String(r[wi]||"").trim() : "",
    date: di>-1 ? String(r[di]||"").trim() : ""
  })).filter(x=>x.username && x.rank>0);
}

/* Leaderboard */
let MODE='daily', DAILY=[], WEEKLY=[], DATES=[], WEEKS=[], CUR_DATE='', CUR_WEEK='', CURRENT_FULL=[];

async function renderRanks(){
  $('#view').innerHTML=`
    <div class="card">
      <div class="lbHead">
        <h2 style="margin:0;font-size:22px">Leaderboard</h2>
        <div class="seg">
          <button id="bDaily"  class="active">Daily</button>
          <button id="bWeekly">Weekly</button>
        </div>
      </div>
      <div class="scope" id="scope"></div>
      <div class="filters">
        <input id="pickDate" class="pick" type="date" style="display:none"/>
        <select id="pickWeek" class="pick" style="display:none"></select>
      </div>
    </div>

    <div class="podiumWrap">
      <div class="podium">
        <div class="step s2">
          <div class="av" id="p2a"></div>
          <div class="badge">2</div>
          <div class="name" id="p2n">‚Äî</div>
          <div class="mini"><span id="p2t">üèÜ</span> <span class="pt" id="p2s"></span> <span>points</span></div>
        </div>
        <div class="step s1">
          <div class="crown">üëë</div>
          <div class="av" id="p1a"></div>
          <div class="badge">1</div>
          <div class="name" id="p1n">‚Äî</div>
          <div class="mini"><span id="p1t">üèÜ</span> <span class="pt" id="p1s"></span> <span>points</span></div>
        </div>
        <div class="step s3">
          <div class="av" id="p3a"></div>
          <div class="badge">3</div>
          <div class="name" id="p3n">‚Äî</div>
          <div class="mini"><span id="p3t">üèÜ</span> <span class="pt" id="p3s"></span> <span>points</span></div>
        </div>
      </div>
    </div>

    <div class="hdrRow"><div>Rank</div><div>Player</div><div>Points</div></div>
    <div class="list" id="lb-list"></div>

    <div class="search">
      <input id="q" class="input" placeholder="Search username (full list)‚Ä¶"/>
      <button id="find" class="go">Find</button>
    </div>
    <div id="mine" class="result"></div>
  `;

  if(!DAILY.length){ try{ DAILY = normalize(await gviz(GID_DAILY)); }catch(e){ console.warn('Daily sheet load failed',e); } }
  if(!WEEKLY.length){ try{ WEEKLY = normalize(await gviz(GID_WEEKLY)); }catch(e){ console.warn('Weekly sheet load failed',e); } }

  DATES = unique(DAILY.map(x=>x.date).filter(Boolean)).sort();
  WEEKS = unique(WEEKLY.map(x=>x.week).filter(Boolean)).sort((a,b)=>{
    const na=(a.match(/\d+/)||[])[0], nb=(b.match(/\d+/)||[])[0];
    return (na&&nb)? na-nb : a.localeCompare(b);
  });
  CUR_DATE = DATES[DATES.length-1]||"";
  CUR_WEEK = WEEKS[WEEKS.length-1]||"";

  const pDate=$('#pickDate'), pWeek=$('#pickWeek');
  if(CUR_DATE){ pDate.value=CUR_DATE; pDate.min=DATES[0]||""; pDate.max=DATES[DATES.length-1]||""; }
  pWeek.innerHTML=WEEKS.map(w=>`<option>${w}</option>`).join(''); pWeek.value=CUR_WEEK;

  const bDaily=$('#bDaily'), bWeekly=$('#bWeekly');
  const setMode=m=>{
    MODE=m;
    bDaily.classList.toggle('active',m==='daily');
    bWeekly.classList.toggle('active',m==='weekly');
    pDate.style.display = m==='daily' ? '' : 'none';
    pWeek.style.display = m==='weekly' ? '' : 'none';
    draw();
  };
  bDaily.onclick=()=>setMode('daily');
  bWeekly.onclick=()=>setMode('weekly');
  pDate.onchange=()=>{CUR_DATE=pDate.value; draw()};
  pWeek.onchange=()=>{CUR_WEEK=pWeek.value; draw()};

  $('#find').onclick=doSearch;
  $('#q').addEventListener('keydown',e=>{ if(e.key==='Enter') doSearch(); });

  setMode(MODE);

  function currentRows(){
    if(MODE==='daily'){ return DAILY.filter(x=> (x.date||'')===CUR_DATE).sort((a,b)=>a.rank-b.rank); }
    return WEEKLY.filter(x=> (x.week||'')===CUR_WEEK).sort((a,b)=>a.rank-b.rank);
  }
  function scopeText(){ return MODE==='daily' ? `Showing: <b>${(CUR_DATE||'‚Äî').split('-').reverse().join('/')}</b>` : `Showing: <b>${CUR_WEEK||'‚Äî'}</b>`; }

  function setPod(n,row){
    const av=$(`#p${n}a`), nm=$(`#p${n}n`), sc=$(`#p${n}s`);
    if(row){
      av.style.backgroundImage=faceBg(rankAvatar(row.rank));
      nm.textContent=maskMiddle3(row.username);
      sc.textContent = fmtFull(row.points); // number only; "points" text is in markup
    }else{ av.style.backgroundImage='none'; nm.textContent='‚Äî'; sc.textContent=''; }
  }

  function draw(){
    $('#scope').innerHTML = scopeText();
    const rows = currentRows();
    CURRENT_FULL = rows.slice();

    setPod(1, rows.find(r=>r.rank===1));
    setPod(2, rows.find(r=>r.rank===2));
    setPod(3, rows.find(r=>r.rank===3));

    const list=$('#lb-list'); list.innerHTML='';
    rows.filter(r=>r.rank>=4 && r.rank<=20).forEach(r=>{
      list.insertAdjacentHTML('beforeend',`
        <div class="row">
          <div class="rk">${r.rank}</div>
          <div class="left">
            <div class="face" style="background-image:${faceBg(rankAvatar(r.rank))}"></div>
            <div class="uname">${maskMiddle3(r.username)}</div>
          </div>
          <div class="val">${fmtFull(r.points)} points</div>
        </div>`);
    });
  }

  function doSearch(){
    const q = ($('#q').value||'').trim().toLowerCase();
    const box = $('#mine'); box.style.display='block';
    if(!q){ box.textContent='Enter a username'; return; }
    const hit = CURRENT_FULL.find(x=>x.username.toLowerCase()===q);
    if(!hit){ box.textContent='No match for the selected period.'; return; }
    const scope = MODE==='daily' ? CUR_DATE : CUR_WEEK;
    box.innerHTML = `<b>${hit.username}</b> ‚Äî Rank <b>${hit.rank}</b> ‚Ä¢ ${fmtFull(hit.points)} pts ‚Ä¢ ${scope}`;
  }
}

/* T&C tab */
function renderHome(){
  $('#view').innerHTML=`
    <div class="card"><h2>Terms & Conditions</h2>
      <ul style="margin:6px 0 0 18px;color:#dfe5ff">
        <li>Each verified signup = <b>+1 point</b>.</li>
        <li><b>Weekly</b> winners announced every Monday.</li>
        <li>Rewards credited within 72 hours after announcement.</li>
        <li>Duplicate/fake signups will be removed; abuse may lead to disqualification.</li>
      </ul>
    </div>`;
}

/* Community */
function renderCommunity(){
  const referUrl=location.href;
  $('#view').innerHTML=`
    <div class="card comm">
      <h2>Share & Follow</h2>
      <p>Invite friends and follow us.</p>
      <div class="sharebar">
        <a class="sharebtn" target="_blank" rel="noopener" href="https://t.me/share/url?url=${encodeURIComponent(referUrl)}">Share on Telegram</a>
        <a class="sharebtn" target="_blank" rel="noopener" href="https://api.whatsapp.com/send?text=${encodeURIComponent('Join me: '+referUrl)}">Share on WhatsApp</a>
      </div>
    </div>
    <div class="comm">
      <div class="list">
        ${[
          ['Facebook','https://facebook.com/','https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg'],
          ['Instagram','https://instagram.com/','https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg'],
          ['Telegram','https://t.me/','https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/telegram.svg'],
          ['X','https://x.com/','https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg'],
          ['YouTube','https://youtube.com/','https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg'],
        ].map(([label,href,icon])=>`
          <div class="item">
            <div class="left">
              <div class="bubble"><img alt="" width="26" height="26" src="${icon}"/></div>
              <div style="font-weight:900">${label}</div>
            </div>
            <a class="sharebtn" style="background:#fff;color:#2a1a00" href="${href}" target="_blank" rel="noopener">Open</a>
          </div>`).join('')}
      </div>
    </div>`;
}

/* Boot */
function render(){ if(TAB==='ranks') renderRanks(); else if(TAB==='home') renderHome(); else renderCommunity(); }
render();
</script>
</body>
</html>
