<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Leaderboard App</title>
<style>
  :root{
    --bg:#0c0c12; --panel:#141424; --panel2:#191932; --ink:#eaf0ff; --muted:#9aa4c7;
    --pri1:#8457ff; --pri2:#a06bff; --pri3:#c28bff; --acc:#ffd86a; --good:#4be1a0;
    --edge:rgba(255,255,255,.08); --glow:rgba(150,120,255,.25);
  }
  *{box-sizing:border-box} html,body{margin:0;height:100%;background:radial-gradient(1200px 700px at 50% -10%, #1a1b3a 0%, transparent 60%), linear-gradient(180deg,#0b0c1a,#070813);color:var(--ink);font:15px/1.5 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;-webkit-tap-highlight-color:transparent}
  .app{max-width:520px;margin:0 auto;min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
  /* Header */
  header{position:sticky;top:0;background:linear-gradient(180deg,#10112a,#0c0d22);border-bottom:1px solid var(--edge);padding:12px 16px;z-index:10}
  .hrow{display:flex;align-items:center;gap:10px}
  .title{font-weight:900;font-size:18px;letter-spacing:.4px}
  .seg{margin-top:10px;background:var(--panel2);border:1px solid var(--edge);padding:4px;border-radius:999px;display:inline-flex;gap:4px}
  .seg button{appearance:none;border:0;background:transparent;color:var(--muted);padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
  .seg button.active{background:linear-gradient(180deg,var(--pri2),var(--pri1));color:#fff;box-shadow:0 2px 10px var(--glow)}
  /* Content */
  main{padding:14px 14px 80px}
  .card{background:linear-gradient(180deg,#151533,#10112a);border:1px solid var(--edge);border-radius:16px;padding:14px}
  .card + .card{margin-top:12px}
  h3{margin:0 0 10px;font-size:16px}
  p{margin:0 0 8px;color:#cbd5ff}
  .muted{color:var(--muted)}
  /* Podium (purple theme) */
  .podiumWrap{position:relative;border-radius:20px;background:linear-gradient(180deg,#c9b3ff,#9f84ff);border:1px solid rgba(255,255,255,.5);box-shadow:0 30px 80px rgba(0,0,0,.45);overflow:hidden}
  .cap{position:absolute;top:8px;left:0;right:0;text-align:center;color:#2b135f;font-size:11px;font-weight:900;letter-spacing:.4px}
  .podium{display:grid;grid-template-columns:1fr 1.2fr 1fr;gap:8px;align-items:end;padding:56px 10px 8px}
  .step{position:relative;border-radius:14px;background:linear-gradient(180deg,#e9deff,#cabaff);border:1px solid rgba(80,40,140,.25);box-shadow:inset 0 -12px 18px rgba(80,40,140,.18),0 8px 18px rgba(0,0,0,.15);padding:8px 6px 10px;display:grid;place-items:center}
  .s1{height:96px}.s2{height:78px}.s3{height:74px}
  .rankDot{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:52px;height:52px;border-radius:50%;display:grid;place-items:center;font-weight:900;color:#2b135f;background:radial-gradient(circle at 35% 30%, #fff 0%, #ffe5a6 50%, #ffc44d 70%);border:2px solid rgba(0,0,0,.08);box-shadow:0 6px 14px rgba(0,0,0,.25)}
  .avatar{position:absolute;top:-56px;left:50%;transform:translateX(-50%);width:68px;height:68px;border-radius:50%;border:3px solid #fff;box-shadow:0 8px 20px rgba(0,0,0,.35);background:#fff center/cover no-repeat}
  .name{margin-top:16px;font-weight:900;color:#2b135f;font-size:12px;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  /* Rank list */
  .search{display:grid;grid-template-columns:1fr auto;gap:8px}
  .input{border-radius:12px;border:1px solid var(--edge);background:#0f1030;color:#eff3ff;padding:10px 12px}
  .btn{appearance:none;border:0;border-radius:12px;background:linear-gradient(180deg,var(--pri2),var(--pri1));color:#fff;font-weight:900;padding:10px 12px;cursor:pointer}
  .table{border:1px solid var(--edge);border-radius:14px;overflow:hidden;margin-top:10px}
  .th,.tr{display:grid;grid-template-columns:60px 1fr 110px;gap:8px;align-items:center}
  .th{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));padding:8px 10px;color:#dfe6ff;font-weight:800}
  .tr{background:linear-gradient(180deg,#0f1133,#0c1030);border-top:1px solid #0a0e28;padding:8px 10px}
  .rk{display:inline-flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:50%;font-weight:900;background:radial-gradient(circle at 35% 30%, #fff, #ffe5a6 55%, #ffc44d 70%);color:#3a2a00;border:2px solid rgba(0,0,0,.06)}
  .rk.silver{background:radial-gradient(circle at 35% 30%, #fff, #eef3ff 55%, #d7e5ff 70%);color:#243152}
  .rk.bronze{background:radial-gradient(circle at 35% 30%, #fff, #ffd8b3 55%, #e7a86f 70%);color:#4a2c12}
  .user{display:flex;align-items:center;gap:10px}
  .face{width:38px;height:38px;border-radius:50%;background:#eee center/cover no-repeat;border:2px solid #fff22}
  .points{justify-self:end;font-weight:900}
  .me{outline:2px solid var(--good);box-shadow:0 0 0 4px rgba(75,225,160,.2)}
  /* Tabs (bottom) */
  nav{position:sticky;bottom:0;background:linear-gradient(180deg,#10112a,#0b0c1f);border-top:1px solid var(--edge);padding:8px 10px}
  .tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .tab{appearance:none;border:1px solid var(--edge);background:var(--panel2);color:#cdd7ff;border-radius:12px;padding:10px 8px;font-weight:800}
  .tab.active{background:linear-gradient(180deg,var(--pri2),var(--pri1));color:#fff;box-shadow:0 6px 18px var(--glow)}
  /* FAQ/Details */
  details{background:var(--panel2);border:1px solid var(--edge);border-radius:12px;padding:10px}
  details+details{margin-top:8px}
  summary{cursor:pointer;font-weight:800}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="hrow">
      <div class="title" id="hdrTitle">Leaderboard</div>
    </div>
    <!-- Segment only visible on RANKS -->
    <div class="seg" id="rangeSeg" style="display:none">
      <button data-range="daily" class="active">Daily</button>
      <button data-range="monthly">Monthly</button>
      <button data-range="all">All time</button>
    </div>
  </header>

  <main id="view">
    <!-- Views injected by JS -->
  </main>

  <nav>
    <div class="tabs">
      <button class="tab active" data-tab="home">Home</button>
      <button class="tab" data-tab="ranks">Ranks</button>
      <button class="tab" data-tab="terms">T&amp;C</button>
      <button class="tab" data-tab="community">Community</button>
    </div>
  </nav>
</div>

<script>
/* ================= CONFIG (Sheets optional) ================= */
const USE_SHEETS = false; // set true to use Google Sheets
const SHEET_ID   = "YOUR_SHEET_ID";      // if USE_SHEETS=true
const SHEET_NAME = "Leaderboard";        // required tab
const MAP = {
  username:["username","user","player","name"],
  score:["score","points","turnover","referrals","total"],
  avatar:["avatarurl","avatar","image","img","icon","photo"],
};
const DAILY   = [{username:'Masuma',score:1490,avatar:''},{username:'Hasan Sajjad',score:1800,avatar:''},{username:'Tanim',score:1205,avatar:''},{username:'Sadia Afrin',score:1000,avatar:''},{username:'Rejaul karim',score:900,avatar:''},{username:'Hasnat',score:800,avatar:''},{username:'Nishat jahan',score:750,avatar:''},{username:'Sajjad (YOU)',score:720,avatar:''}];
const MONTHLY = DAILY.map((x,i)=>({...x,score:Math.round(x.score*3.2 - i*20)}));
const ALL     = DAILY.map((x,i)=>({...x,score:Math.round(x.score*7.1 - i*50)}));
/* ================= UTIL ================= */
const $ = (sel, el=document)=> el.querySelector(sel);
const $$= (sel, el=document)=> [...el.querySelectorAll(sel)];
function fmt(n){ return Number(n||0).toLocaleString(); }
function esc(s){ return String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]); }
function faceBg(url){ return url? `url("${url}")` : `url('data:image/svg+xml;utf8,${encodeURIComponent(svgAvatar())}')`; }
function svgAvatar(){return `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%23ffd1ff'/><stop offset='100%' stop-color='%238857ff'/></linearGradient></defs><rect width='64' height='64' rx='16' fill='url(%23g)'/><circle cx='32' cy='26' r='12' fill='white' opacity='.9'/><rect x='14' y='40' width='36' height='16' rx='8' fill='white' opacity='.9'/></svg>`; }
function pickIndex(headers, aliases){ const L=headers.map(h=>String(h||'').toLowerCase()); for(const a of aliases){const i=L.findIndex(h=>h.includes(a)); if(i>-1) return i;} return -1; }
/* ================= SHEETS (optional) ================= */
async function fetchGViz(){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
  const res=await fetch(url,{cache:'no-store'}); const text=await res.text();
  const jsonStr=text.match(/google\.visualization\.Query\.setResponse\((.*)\);?/s)?.[1];
  if(!jsonStr) throw new Error('GViz JSON parse failed');
  const data=JSON.parse(jsonStr); const headers=data.table.cols.map(c=>c.label||c.id||"");
  const rows=data.table.rows.filter(r=>r&&r.c).map(r=> r.c.map(c=> c ? (c.f ?? c.v):""));
  const ui=pickIndex(headers, MAP.username), si=pickIndex(headers, MAP.score), ai=pickIndex(headers, MAP.avatar);
  return rows.map(r=>({username:String(r[ui]??'').trim(), score:Number(String(r[si]).replace(/[^\d.\-]/g,''))||0, avatar:(ai>-1? String(r[ai]??'').trim():'')})).filter(x=>x.username);
}
/* ================= VIEWS ================= */
const state = { tab:'home', range:'daily', data:{daily:DAILY, monthly:MONTHLY, all:ALL} };

function render(){
  // header title + segment visibility
  $('#hdrTitle').textContent = state.tab==='ranks' ? 'Leaderboard' :
                               state.tab==='terms' ? 'Terms & FAQ' :
                               state.tab==='community' ? 'Community' : 'Event';
  $('#rangeSeg').style.display = state.tab==='ranks' ? 'inline-flex' : 'none';
  $$('.tab').forEach(btn=> btn.classList.toggle('active', btn.dataset.tab===state.tab));
  $$('#rangeSeg button').forEach(b=> b.classList.toggle('active', b.dataset.range===state.range));

  if(state.tab==='home') return renderHome();
  if(state.tab==='ranks') return renderRanks();
  if(state.tab==='terms') return renderTerms();
  if(state.tab==='community') return renderCommunity();
}

function renderHome(){
  $('#view').innerHTML = `
    <div class="card">
      <h3>Event details</h3>
      <p><b>When:</b> Daily/Monthly competition. Scores reset daily at 00:00.</p>
      <p><b>How to win:</b> Earn points by completing tasks and quizzes.</p>
      <p><b>Rewards:</b> Top 10 daily, bigger prizes monthly. Winners announced in-app.</p>
      <p class="muted">Tip: Invite friends to earn bonus points!</p>
    </div>
    <div class="card">
      <h3>Todayâ€™s highlights</h3>
      <p>ðŸ”¥ Double points on quizzes from 6â€“8 PM.</p>
      <p>ðŸŽ¯ Streak bonus +15 for 5 days in a row.</p>
    </div>`;
}

function renderRanks(){
  const items = state.data[state.range].slice().sort((a,b)=> b.score-a.score);
  const [first,second,third] = [items[0],items[1],items[2]];
  $('#view').innerHTML = `
    <div class="podiumWrap">
      <div class="cap">${state.range.charAt(0).toUpperCase()+state.range.slice(1)} Podium</div>
      <div class="podium">
        <div class="step s2"><div class="rankDot">2</div><div class="avatar" id="p2a"></div><div class="name" id="p2n">â€”</div></div>
        <div class="step s1"><div class="rankDot">1</div><div class="avatar" id="p1a"></div><div class="name" id="p1n">â€”</div></div>
        <div class="step s3"><div class="rankDot">3</div><div class="avatar" id="p3a"></div><div class="name" id="p3n">â€”</div></div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="search">
        <input id="searchName" class="input" placeholder="Search usernameâ€¦"/>
        <button class="btn" id="findBtn">Find</button>
      </div>
      <div class="table" style="margin-top:10px">
        <div class="th"><div>Rank</div><div>Player</div><div>Points</div></div>
        <div id="tbody"></div>
      </div>
      <div id="meSpot" class="card" style="display:none;margin-top:10px;background:#10203e">
        <div id="meText" class="muted">Your position</div>
      </div>
    </div>`;

  // fill podium
  const set = (id, row)=>{ $(`#${id}a`).style.backgroundImage=faceBg(row?.avatar||''); $(`#${id}n`).textContent=row?.username||'â€”'; };
  set('p1',first); set('p2',second); set('p3',third);

  // list
  const body = $('#tbody'); body.innerHTML='';
  items.forEach((r,i)=>{
    const tr=document.createElement('div'); tr.className='tr'; tr.dataset.user=r.username.toLowerCase();
    const place=i+1, cls = place===2?'silver':place===3?'bronze':'';
    tr.innerHTML = `<div class="rk ${cls}">${place<=3?(place===1?'1st':place===2?'2nd':'3rd'):place}</div>
      <div class="user"><div class="face" style="background-image:${faceBg(r.avatar)}"></div><div>${esc(r.username)}</div></div>
      <div class="points">${fmt(r.score)} pts</div>`;
    body.appendChild(tr);
  });

  // search
  $('#findBtn').onclick = ()=>{
    const val=$('#searchName').value.trim().toLowerCase();
    if(!val) return;
    const idx=items.findIndex(x=>x.username.toLowerCase()===val);
    if(idx<0){ $('#meText').textContent='No match found.'; $('#meSpot').style.display='block'; return; }
    const place=idx+1, row=items[idx];
    $('#meText').innerHTML = `<b>${esc(row.username)}</b> â€” Rank <b>${place}</b> â€¢ ${fmt(row.score)} pts`;
    $('#meSpot').style.display='block';
    const hit=$(`.tr[data-user="${val}"]`); if(hit){ hit.classList.add('me'); hit.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>hit.classList.remove('me'),1600); }
  };
}

function renderTerms(){
  $('#view').innerHTML = `
    <div class="card">
      <h3>Terms & Conditions</h3>
      <p>1) Points are earned by in-app activities. 2) Anti-fraud filters apply. 3) We may change rewards with notice.</p>
      <p>By participating, you agree to these terms.</p>
    </div>
    <div class="card">
      <h3>FAQ</h3>
      <details><summary>How often is the leaderboard updated?</summary><p>Live; values are refreshed whenever you open the Ranks tab.</p></details>
      <details><summary>When are rewards paid?</summary><p>Daily winners paid within 24h, monthly within 3 days.</p></details>
      <details><summary>Can I change my username?</summary><p>Yes, from your profile; rank history stays attached.</p></details>
    </div>`;
}

function renderCommunity(){
  $('#view').innerHTML = `
    <div class="card"><h3>Join the community</h3>
      <p><a href="#" class="muted">Telegram</a> â€¢ <a href="#" class="muted">Discord</a> â€¢ <a href="#" class="muted">X / Twitter</a></p>
      <p>Share tips, meet players, and get event announcements first.</p>
    </div>`;
}

/* ================= NAV & RANGE ================= */
$$('.tab').forEach(btn=> btn.onclick = ()=>{ state.tab = btn.dataset.tab; render(); });
$$('#rangeSeg button').forEach(btn=> btn.onclick = ()=>{ state.range = btn.dataset.range; render(); });

/* ================= BOOT ================= */
(async function(){
  if(USE_SHEETS){
    try{
      const rows = await fetchGViz();
      // If your sheet has separate tabs for daily/monthly/all, fetch each; here we just use one
      state.data.daily = rows; state.data.monthly = rows; state.data.all = rows;
    }catch(e){ console.warn('Sheets fetch failed, using sample.', e); }
  }
  render();
})();
</script>
</body>
</html>
